<!--Author: Ezra Gerris, Thijs Lacquet and Tanja Markink-->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="main.css">
	<link rel="stylesheet" href="rangeslider.css">
	<script src="Scripts/Visualizations/visualization.js" type="text/javascript"></script>
	<script src="Scripts/Visualizations/Heatmap.js" type="text/javascript"></script>
	<script src="Scripts/Visualizations/Scarfplot.js" type="text/javascript"></script>
	<script src="Scripts/Visualizations/Scanpath.js" type="text/javascript"></script>
	<script src="Scripts/Visualizations/ParallelScanpath.js" type="text/javascript"></script>
	<script src="Scripts/Visualizations/data.js" type="text/javascript"></script>
	<script src="Scripts/Visualizations/AOIselection.js" type="text/javascript"></script>
	<script src="Scripts/Visualizations/rangeslider.js" type="text/javascript"></script>
	<script src="Scripts/DraggableUser.js" type="text/javascript"></script>
	<script src="Scripts/UserContainer.js" type="text/javascript"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<!--<link rel="stylesheet" type="text/css" href="../Visualizations/visualization.css">-->
	<title>Test page for linking visualizations</title>




</head>
<body style="font-family: sans-serif;">

	<div class="nav">
		<a href="index.htm">Home</a>
		<a href="visualization.htm">Visualization</a>
		<a href="upload.htm">Upload</a>
		<a class="active" href="#test">Test</a>
	</div>

	<div class="header">
		<h1>Test page</h1>
		<p>By group 39</p>
	</div>

	<script>
	function load() {
		var array = null;
		var superThis = this;
		$.post( "/Scripts/imageNames.php", function( data ) {
			array = JSON.parse(data);
			superThis.loading(array);
		});
	}

	function loading(data) {
		//Select background image
		var i = 0;
		var imageNameContainer = document.getElementById("imageNameContainer")
		var tempHtml = ""
		while (i < data.length) {
			tempHtml = tempHtml + '<a id="myLink" onclick="MyFunction(' + "'" + data[i] + "'" + ');">' + data[i] + '</a>'
			i = i + 1;
		}
		imageNameContainer.innerHTML = tempHtml
	}
	load()
	</script>

	<script>
	function MyFunction(image) {
		var imagePath = "Scripts/getImage.php?img=" + image;
		myHeatmap.setImage(imagePath);
		myScanpath.setImage(imagePath);
		myScarfplot.setImage(imagePath);
		aoiImg.src = imagePath;

		window.d = new data(image, update);
		userContainer.draw(data);
	}
	</script>

	<!--JS dropdown menu-->
	<script>
	function hideOrShow() {
		document.getElementById("dropdown").classList.toggle("show");
	}

	function filterFunction() {
		var input, filter, b, c;
		input = document.getElementById("input");
		filter = input.value.toUpperCase();
		div = document.getElementById("dropdown");
		b = div.getElementsByTagName("a");
		for (c = 0; c < b.length; c++) {
			txtValue = b[c].textContent || b[c].innerText;
			if (txtValue.toUpperCase().indexOf(filter) > -1) {
				b[c].style.display = "";
			} else {
				b[c].style.display = "none";
			}
		}
	}
	</script>

	<div class="grid_tools">
		<div class="dropdown">
			<button onclick="hideOrShow()" class="dropbutton">Select a background image</button>
			<div id="dropdown" class="content">
				<input type="text" placeholder="Search..." id="input" onkeyup="filterFunction()">
				<div id="imageNameContainer">
				</div>
			</div>
		</div>
		<div class="download">
			<input type="button" class="button" id="download_heatmap" value="Download heatmap"/>
			<input type="button" class="button" id="download_scarfplot" value="Download scarfplot"/>
			<input type="button" class="button" id="download_scanpath" value="Download gaze plot"/>
			<input type="button" class="button" id="download_parallelscanpath" value="Download parallel scanpath"/>
			<input type="button" class="button" id="download_aoi" value="Download AOIs"/>
		</div>
		<div class="tool3">
			<div id="userDropdown" class="contentUsers">
				<a>Enable/disable or swap users</a>
				<div id="userContainer">
				</div>
			</div>
		</div>
		<div class="tool4">
			Alter the radius in the heatmap
			<input type="range" min="1" max="200" value="40" class="slider" id="heatmapRadius">
		</div>
		<div class="tool5">
			Alter the radius in the gaze plot
		<div class="slidecontainer">
  		<input type="range" min="1" max="30" value="15" class="slider" id="myRange">
  		<p>Value: <span id="value"></span></p>
  	</div>
		</div>
		<div class="tool6">tool6</div>
		<div class="tool7">tool7</div>
	</div>

	<script>
		var userContainerID = document.getElementById("userContainer");
		userContainer = new UserContainer(userContainerID);

	var slider = document.getElementById("myRange");
	var output = document.getElementById("value");
	output.innerHTML = slider.value; // Display the default slider value

	// Update the current slider value (each time you drag the slider handle)
	slider.oninput = function() {
	  output.innerHTML = this.value;
	  size = (this.value/1000);
	  myScanpath.clearVisualization();
	  myScanpath.setData(d, size);
	  myScanpath.draw();
	}
	</script>

	<div class="grid_linking">
		<div class="heatmapE">
			<div id="visContainerHM">
				<div id="visImgContainerHM">
						<img id="myImageHM">
				</div>
				<div id="visCanvasContainerHM">
					<canvas id="myCanvasHM"></canvas>
				</div>
			</div>
		</div>

		<div class="scarfplotE">
			<div id="visContainerSP">
				<div id="visImgContainerSP">
						<img id="myImageSP">
				</div>
				<div id="visCanvasContainerSP">
					<canvas id="myCanvasSP"></canvas>
				</div>
			</div>
			<div id="scarfPlotContainer">
				<canvas id="scarfCanvas"></canvas>
			</div>
		</div>

		<div class="scanpathE">
			<div id="visContainerSC">
				<div id="visImgContainerSC">
					<img id= "myImageSC">
				</div>
				<div id="visCanvasContainerSC">
					<canvas id="myCanvasSC"></canvas>
				</div>
			</div>
		</div>

		<div class="parallelSP">
			<div id="visContainerPSP">
				<div id="visCanvasContainerPSP">
					<canvas id="myCanvasPSP"></canvas>
				</div>
			</div>
		</div>
	</div>

	<div>
		<div id="AOISelection" style="width: 800px;font-size: 0">
			<img id="aoiImage" style="width: 100%;z-index: 1">
		</div>
		<button class="setButton" onclick="updateAOIs();">set AOIs</button>
	</div>


	<div>
		<div id="timeslider" style="height: 100px"></div>
		<div id="durationslider" style="height: 100px"></div>
		<button onclick="updateFilter()">set</button>
	</div>

	<!--Temporary download buttons for the visualizations, please move them to a nicer spot and make them look better -->
	<input type="button" id="download_heatmap" value="Download heatmap"/>
	<input type="button" id="download_scarfplot" value="Download scarfplot"/>
	<input type="button" id="download_scanpath" value="Download scanpath"/>
	<input type="button" id="download_parallelscanpath" value="Download parallelscanpath"/>

	<script>
			var imageName;
			var myAOIselection = new AOIselection();

			window.d = null;
			var d = window.d;

			//Execute php script to access image outside of webserver root directory
			var imagePath = "Scripts/getImage.php?img=" + imageName;

			<!--Aoi image selector -->
			var aoiImg = document.getElementById('aoiImage');
			aoiImg.src = imagePath;
			var myAOIselection;

			//Initialize aoiselection if image is loaded
			if (aoiImg.naturalWidth != 0) {
				myAOIselection = new AOIselection();
			} else {
				aoiImg.onload = function () {
					myAOIselection = new AOIselection();
					aoiImg.onload = function () {} //Rest onload function
				}
			}


			<!--Drawing the heatmap-->
			var img = document.getElementById('myImageHM');
			var canvas = document.getElementById('myCanvasHM');
			var visContainerHM = document.getElementById('visContainerHM');
			var visImgContainerHM = document.getElementById('visImgContainerHM');
			var download_button = document.getElementById("download_heatmap");
			var slider = document.getElementById("heatmapRadius");

			myHeatmap = new Heatmap(canvas, img, slider);
			myHeatmap.setDownloadButton(download_button, canvas);
			myHeatmap.setImage(imagePath);

			<!--Drawing the scarfplot-->
			var img = document.getElementById('myImageSP');
			var canvas = document.getElementById('myCanvasSP');
			var visContainerSP = document.getElementById('visContainerSP');
			var visImgContainerSP = document.getElementById('visImgContainerSP');
			var scarfCanvas = document.getElementById('scarfCanvas');
			var scarfPlotContainer = document.getElementById('scarfPlotContainer');
			var download_button = document.getElementById("download_scarfplot");
			var download_aoi = document.getElementById("download_aoi");

			myScarfplot = new Scarfplot(canvas, scarfCanvas, img);
			myScarfplot.setDownloadButton(download_button, scarfCanvas);
			myScarfplot.setDownloadButton(download_aoi, canvas);
			myScarfplot.setImage(imagePath);

			<!--Drawing the scanpath-->;
			var size = 0.01;

			var img = document.getElementById('myImageSC');
			var canvas = document.getElementById('myCanvasSC');
			var visContainerSC = document.getElementById('visContainerSC');
			var visImgContainerSC = document.getElementById('visImgContainerSC');
			var download_button = document.getElementById("download_scanpath");

			var width = visImgContainerSC.clientWidth;
			var height = visImgContainerSC.clientHeight;

			myScanpath = new Scanpath(canvas, img);
			myScanpath.setDownloadButton(download_button, canvas);
			myScanpath.setImage(imagePath);

	<!--setting up the parallel scanpath-->

			var canvas = document.getElementById('myCanvasPSP');
			var visContainerPSP = document.getElementById('visContainerPSP');
			var download_button = document.getElementById("download_parallelscanpath");

			myParallelScanpath = new ParallelScanpath(canvas);
			myParallelScanpath.setDownloadButton(download_button, canvas);

	<!--data & drawing -->
			function setData(d){
				d.divideInAOIs();

				myParallelScanpath.setData(d);
				myScarfplot.setData(d);
				myScanpath.setData(d, size);
				myHeatmap.setData(d);
			}

			function draw(){
				myParallelScanpath.clearVisualization();
				myScarfplot.clearVisualization();
				myScanpath.clearVisualization();
				myHeatmap.clearVisualization();
				myParallelScanpath.draw();
				myScarfplot.draw();
				myScanpath.draw();
				myHeatmap.draw();

				userContainer.draw(d);
			}

			function datainit(d){
				makesliders(d);
			}

			function update(d){
				setData(d);
				draw();
			}

			var d = new data(imageName, update, datainit);
      window.d = d;

			var timeslider;
			var durationslider;

			function makesliders(d){
				var maxt = d.maxtime;
				var maxdt = d.getmaxduration();

				timeslider = new RangeSlider({
				    id:"timeslider",
				    range: {min:0, max:maxt},
				    handles:[0, maxt],
				    width:300,
				    displayValue:true
				});

				durationslider = new RangeSlider({
				    id:"durationslider",
				    range: {min:0, max:maxdt},
				    handles:[0, maxdt],
				    width:300,
				    displayValue:true
				});
			}

			function updateAOIs(){
				var AOIs = myAOIselection.getcoords();
				d.setAOIs(AOIs);
				d.update();
			}

			function updateFilter(){
				var timeinterval = timeslider.getInterval();
				var durationinterval = durationslider.getInterval();

				d.resetentryfilter();
				d.timeRange(timeinterval[0], timeinterval[1]);
				d.durationRange(durationinterval[0], durationinterval[1]);

				d.update();
			}
	</script>
	<script>
		var imagePath = "Images/foto.png";

		myHeatmap.setImage(imagePath);
		myScanpath.setImage(imagePath);
		myScarfplot.setImage(imagePath);
		aoiImg.src = imagePath;
		myHeatmap.clearVisualization();
		myScanpath.clearVisualization();
		myScarfplot.clearVisualization();
		


	</script>

</body>
</html>
